

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      active-break-pages.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      WePomo's Pomo Timer
    </h3>

    

    <h3>Classes</h3><ul><li id="TaskComponent-nav"><a href="TaskComponent.html">TaskComponent</a></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#abortTimer">abortTimer</a></li><li><a href="global.html#calculateTotalTime">calculateTotalTime</a></li><li><a href="global.html#checkEmpty">checkEmpty</a></li><li><a href="global.html#deleteComponent">deleteComponent</a></li><li><a href="global.html#populateTasks">populateTasks</a></li><li><a href="global.html#redirectToPage">redirectToPage</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#setAlert">setAlert</a></li><li><a href="global.html#setup_localStore">setup_localStore</a></li><li><a href="global.html#startTimer">startTimer</a></li><li><a href="global.html#updateCounter">updateCounter</a></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        active-break-pages.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>/*global tasklist, copytasklist, completed, setup_value, totalpomo*/
/* eslint-disable no-unused-vars */


//Active page button, timer, and progress bar 
const activebutton = document.getElementById('pomo-button');
const activetimer = document.getElementById('timer');
const activebar = document.getElementById('progress-bar');
const barwidth = 600; //600px in style.css


//Break page button and timer
const breakbutton = document.getElementById('break-button');
const breaktimer = document.getElementById('break-timer');
const breakbar = document.getElementById("break-bar");
const breaktitle = document.getElementById("break-title");

//Sounds for both active and break page
const tick = document.getElementById('tick');
const click = document.getElementById('click');
const beep = document.getElementById('beep');



//timer variables
let activetime = 8; //should be set to pomodoro timer (1500s/ 1800s/ 2100s) == (25mins/ 30mins/ 35mins)
let shortbreaktime = 5; // should be set to break time (5mins /)
let longbreaktime = 10;
let counter = activetime; 
let state;
let longbreakindicator = 3; // by default, after 3 short breaks, a long break will occur (when set to 3)
let longbreakcounter = 0; // by default, after 3 short breaks, a long break will occur (when set to 3)
let pomos;

//alert sound that plays every X mins
let alertsound;
let alertfrequency; // the X mins, options are every 5, 10, or 15 mins
let alertindicator = null;
let totalcounter = 0;

/*
    function that set up timer based on user's set-up values.
    As default (timer/counter is 8, default shortbreaktime = 5, default longbreaktime = 10) for testing
*/
function set_time(){   
    if(setup_value[0]==''){
        activetime=8;
    }
    else{
        activetime = 60 * setup_value[0];
    }
    if(setup_value[1]!=''){
        longbreakindicator = setup_value[1] - 1;
    }
    if(setup_value[2]==''){
        shortbreaktime = 5;
    }
    else{
        shortbreaktime = 60 * setup_value[2];
    }
    if(setup_value[3]==''){
        longbreaktime  = 10;
    }
    else{
        longbreaktime  = 60 * setup_value[3];
    }
}


// Variables to keep track of tasks:
let actualpomo = {}; //store how many pomos you spend on a task
let pomocount = 0; 
let currTask;
let completedtask = []; // During break page, check off tasks is stored in completetask and after break page, checked off task is moved to actualpomo

//warning variable, bool for warning prompt when clicking on abort, second click will abort pomo
let abortClicked = false;



/**
 *  Clicking on abort button on active page will first warn the user
 *  that aborting will end the session. Second click on abort will
 *  end the timer and redirect to results page
 */
activebutton.addEventListener('click', ()=>{
    if (abortClicked) {
        actualpomo[currTask] = pomocount;
        abortTimer();
    }
    else {
        alert("Abort will end all pomo sessions, click again if you want to continue");
        abortClicked = true;
    }
});

/**
 *  Clicking on abort button on break page will first warn the user
 *  that aborting will end the session. Second click on abort will
 *  end the timer, update the task list (how many pomos are spent on the task) for
 *  local storage, and redirect to results page
 */
breakbutton.addEventListener('click', ()=>{
    if (abortClicked) {
        actualpomo[currTask] = pomocount;
        if (completed.includes(tasklist[0][0])){
            tasklist.splice(0, 1);
            currTask = tasklist[0] ? tasklist[0][0] : false;
        }
        abortTimer();
    }
    else {
        alert("Abort will end all pomo sessions, click again if you want to continue");
        abortClicked = true;
    }
});

/**
 *  Increments pomocount everytime user reach break page and 
 *  resets pomocount when user checks off at least one task in break page.
 *  Sets timer to count down in active and break page
 *  Once timer reaches zero, either redirect to active or break page if there are still tasks left or
 *  if there is no more tasks, redirect to results page
 *  @param {string} page - current page of user
 */
function startTimer(page){
    // gets current task
    let task = tasklist[0] ? tasklist[0][0] : false;
    if (page == "break") {
        pomocount++; //as user enters break page, increment pomo count of current task
    }
    else {
        if (completedtask.length){ // as user enters active page, reset pomo count if task was checked off from break page
            for (const task of completedtask){ actualpomo[task] = pomocount/completedtask.length; }
            pomocount = 0;
            completedtask = [];
        }
        currTask = task; //update new current task if task was checked off from break page
    }
    if (pomos == 0){ // if user runs out of time, end session
        currTask ? actualpomo[currTask] = pomocount : false;
        abortTimer();
    }

    // updates current task displayed on active page or if user runs of tasks, end sesson
    page == "active" &amp;&amp; task ? document.getElementById("first-task").textContent = "Task: " + task : task ? false : abortTimer(); 

    //plays sound as user enters different page
    click.play();

    //refreshes page and variables for pages
    reset(page);

    //sets start timer
    updateCounter(page);

    //sets alert settings
    setAlert();

    //timer
    state = setInterval(()=>{
        totalcounter++; //counter used for alert settings
        counter -= 1; //decrement timer
        counter == 0 ? redirectToPage(page) : (counter &lt; 6 ? tick.play() : false); // redirects pages when timer hits 0 and plays ticks last 5 secs
        if (alertsound) (totalcounter%(alertfrequency*60)) == 0 ? beep.play() : false; // alert user every (5, 10, or 15) mins
        if (page == "active"){ //updates progress bar and timer as timer decrements on active page
            activebar.style.width = ((barwidth*counter)/activetime).toString() + "px";
            updateCounter("active");
        }
        else { //updates progress bar and timer as timer decrements on break page
            breakbar.style.width = breaktitle.textContent == "Long Break" ? ((barwidth*counter)/longbreaktime).toString() + "px" : ((barwidth*counter)/shortbreaktime).toString() + "px";
            updateCounter("break");
        }
    },1000);
}

/**
 *  Function used in startTimer to redirect to active or break page. If came from active page
 *  hide active page and transition to break page. Else if came from break page hide break page,
 *  remove all tasks that are checked off from task list, and transition to active page.
 *  @param {string} curPage - current page of user to know which page to switch to
 */
function redirectToPage(curPage){
    clearInterval(state);
    beep.play();
    setTimeout(function(){ 
        if (curPage == "active"){
            // if user is on active page, redirect to break page
            document.getElementById("active-page").style.display = "none";
            document.getElementById("break-page").style.display = "inline";
            document.getElementById("to-break-page").click();
            startTimer("break");
            
        }
        else if (curPage == "break"){
            // if user is on break page, redirect to active page with updated task
            if (completed.includes(tasklist[0][0])){
                // if user checked off a task on break page, update tasklist variable and break page
                let task = document.getElementById('break-task-container').children[1];
                if (task) {
                    //updates break page tasks
                    document.getElementById('break-task-container').children[1].remove();
                    let completed = document.createElement("task-component");
                    completed.setAttribute('left-pointer-event', "none");
                    completed.setAttribute('set-right-input', pomocount);
                    completed.setAttribute('left-task', tasklist[0][0]);
                    completed.setAttribute('delete', 'none');
                    document.getElementById("completed-task-container").appendChild(completed);
                    completedtask.push(tasklist[0][0]);
                    tasklist.splice(0, 1);


                    let newTask = document.getElementById('incompleted-task-container').children[1];
                    if (newTask){
                        document.getElementById('incompleted-task-container').children[1].remove();
                        let newTask = document.createElement("task-component");
                        newTask.setAttribute('type', "checkbox");
                        newTask.setAttribute('left-task', tasklist[0][0]);
                        newTask.setAttribute('left-pointer-event', "none");
                        newTask.setAttribute('remove-right-suffix', "none");
                        newTask.setAttribute('delete', 'none');
                        document.getElementById("break-task-container").appendChild(newTask);
                    }
                }
            }
            //decrements amount of pomos remaining, when hits 0, end session
            pomos--;
            document.getElementById("active-page").style.display = "inline";
            document.getElementById("break-page").style.display = "none";
            startTimer("active");
            document.getElementById("to-active-page").click();
            
        }
    }, 500);
}

/**
 *  Used in startTimer to display timer countdown on html title and timer p element.
 *  @param {string} page - current page of user
 */
function updateCounter(page){
    let mins = Math.floor(counter / 60);
    let secs = counter % 60;
    mins = mins &lt; 10 ? "0" + parseInt(mins) : parseInt(mins);
    secs = secs &lt; 10 ? "0" + parseInt(secs) : parseInt(secs);
    if (page == "active"){
        activetimer.innerHTML = mins + ":" + secs;
        document.title = mins + ":" + secs + " Active Timer";
    }
    else if (page == "break"){
        breaktimer.innerHTML= mins + ":" + secs;
        document.title = mins + ":" + secs + " Break Timer";
    }
}

/**
 *  Function used in startTimer to reset timer variables, 
 *  warning variable, and progress bar.
 *  @param {string} page - current page of user
 */
function reset(page){
    if (!pomos) pomos = totalpomo;
    state = null;
    if (page == "active") counter = activetime;
    else {
        if (longbreakcounter >= longbreakindicator) {
            longbreakcounter = 0;
            counter = longbreaktime;
            breaktitle.textContent = "Long Break";
        }
        else {
            longbreakcounter++;
            counter = shortbreaktime;
            breaktitle.textContent = "Short Break";
        }
    }
    alertindicator = null;
    abortClicked = false;
    activebar.style.width = "600px";
    breakbar.style.width = "600px";
}

/**
 *  Function used in startTimer when all tasks are completed or button when 
 *  user clicks abort. It will save data to local storage in JSON format 
 *  and redirect user to results page.
 */
function abortTimer(){
    clearInterval(state);
    beep.play();
    let output = [];
    // sets the JSON data to save to local storage for results page
    for (let i = 0; i &lt; copytasklist.length; i++){
        let objTask = {};
        objTask.id = i;
        objTask.expectedpomos = copytasklist[i][1];
        objTask.actualpomos = actualpomo[copytasklist[i][0]] ? actualpomo[copytasklist[i][0]] : 0;
        objTask.currrenttask = copytasklist[i][0] == currTask;
        objTask.completed = completed.includes(copytasklist[i][0]) ? true : false;
        objTask.taskdescription = copytasklist[i][0];
        output.push(objTask);
    }
    window.localStorage.setItem("tasks", JSON.stringify(output)); 
    document.getElementById("active-page").style.display = "none";
    document.getElementById("break-page").style.display = "none";
    document.location.replace('../HTML/results-page.html');
    
}

/**
 * Function used in startTimer() as user enters active page to set alert sounds that is played every (5, 10, or 15) mins 
 */
function setAlert(){
    alertsound = document.getElementById("alert-right-container").style.display == "inline" ? true : false;
    alertfrequency = document.getElementById("alert-frequency").value; // the X mins, options are every 5, 10, or 15 mins
}
</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
